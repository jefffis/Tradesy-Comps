<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
	    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" />
	    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Tradesy.com Filters</title>
		<link rel="stylesheet" href="css/app.css" />
	</head>
	<body>

		<header></header>

		<div id="content">
			<div id="filter-sort" class="cf">
				<button type="button" class="toggle-filters">Filter</button>
				<button type="button" id="sort">
					Sort
				</button>
			</div>
			<small>
				Viewing 1-24 of 59,291 items<!--  in <strong>Shoes</strong> -->
				<button type="button"><!-- Share -->&nbsp;</button>
			</small>
			<div class="cf">
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
			</div>
		</div>
		<div id="sort-actions">
			<div class="intro">
				Sort items by:
				<button type="button" id="close-sort"></button>
			</div>
			<a class="active">Relevance</a>
			<a>New Arrivals</a>
			<a>Most Loved</a>
			<a>Lowest $ to Highest $$$</a>
			<a>Highest $$$ to Lowest $</a>
		</div>
		<div id="filters">
			<div class="intro">
				Filter Items:
				<button type="button" class="toggle-filters"></button>
			</div>
			<div id="filter-wrapper">
				<!-- <div class="filter department" data-toggleable>
					<h2 data-selected="All">Department</h2>
					<div>
						<label>
							<input type="radio" name="department" value="All" checked />
							<span>All</span>
						</label>
						<label>
							<input type="radio" name="department" value="Clothing" data-sizing />
							<span>Clothing</span>
						</label>
						<label>
							<input type="radio" name="department" value="Bags" />
							<span>Bags</span>
						</label>
						<label>
							<input type="radio" name="department" value="Shoes" data-sizing />
							<span>Shoes</span>
						</label>
						<label>
							<input type="radio" name="department" value="Accessories" />
							<span>Accessories</span>
						</label>
						<label>
							<input type="radio" name="department" value="Weddings" />
							<span>Weddings</span>
						</label>
					</div>
				</div> -->
				<div class="filter" data-toggleable>
					<h2 data-selected="All">Shoes</h2>
					<div>
						<label>
							<input type="checkbox" name="shoes" value="Boots &amp; Booties" data-sizing />
							<span>Boots &amp; Booties</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Flats" data-sizing />
							<span>Flats</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Mules &amp; Clogs" data-sizing />
							<span>Mules &amp; Clogs</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Pumps" data-sizing />
							<span>Pumps</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Sandals" data-sizing />
							<span>Sandals</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Athletic" data-sizing />
							<span>Athletic</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Platforms" data-sizing />
							<span>Platforms</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Wedges" data-sizing />
							<span>Wedges</span>
						</label>
						<label>
							<input type="checkbox" name="shoes" value="Formal" data-sizing />
							<span>Formal</span>
						</label>
					</div>
				</div>
				<hr />
				<div class="filter-card">
					<div id="sizing">
						<h2>Size</h2>
						<div id="size"></div>
					</div>
					<h2>Price</h2>
					<div id="slider" data-selected="Under $25" data-selected-after="Over $500">
						<span>Under $25</span>
						<span>Over $500</span>
					</div>
					<hr />
					<h2 data-selected="All items">Sale</h2>
					<div id="toggle"></div>
					<hr />
					<h2>Availability</h2>
					<div id="tab" class="cf">
						<span class="active">All Items</span>
						<span>In Stock</span>
						<span>Sold Out</span>
					</div>
				</div>
				<div class="filter" data-toggleable>
					<h2 data-selected="All">Designer</h2>
					<div>
						<label class="hidden">
							<input type="checkbox" name="designer" value="Another Designer" data-return />
							<span>Another Designer</span>
						</label>
						<label class="hidden">
							<input type="checkbox" name="designer" value="And More Designer" data-return />
							<span>And More Designer</span>
						</label>
						<label>
							<input type="checkbox" name="designer" value="Louis Vuitton" data-return />
							<span>Louis Vuitton</span>
						</label>
						<label>
							<input type="checkbox" name="designer" value="Chanel" data-return />
							<span>Chanel</span>
						</label>
						<label>
							<input type="checkbox" name="designer" value="Lululemon" data-return />
							<span>Lululemon</span>
						</label>
						<label>
							<input type="checkbox" name="designer" value="Hermes" data-return />
							<span>Hermes</span>
						</label>
						<label>
							<input type="checkbox" name="designer" value="Zara" data-return />
							<span>Zara</span>
						</label>
						<div class="inline cf">
							<label>
								<span>Find a Designer:</span>
								<input type="text" name="search-designer" autocomplete="off" />
							</label>
							<!-- <button type="button">Search</button> -->
						</div>
					</div>
				</div>
				<hr />
				<div class="filter">
					<h2 data-selected="All">Color</h2>
				</div>
				<hr />
				<div class="filter">
					<h2 data-selected="All">Collection</h2>
				</div>
				<hr />
				<div class="filter">
					<h2 data-selected="All">Condition</h2>
				</div>
				<hr />
				<div class="filter">
					<h2 data-selected="All">Discount</h2>
				</div>
			</div>
			<div id="apply">
				<button>Apply Filters</button>
				<!-- <button>Reset</button> -->
				<span id="result-num">59291</span>
			</div>
		</div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script>

			$(function() {
				var button = $('.toggle-filters'),
					filters = $('#filters'),
					tabs = $('span', '#tab'),
					toggle = $('#toggle'),
					apply = $('#apply'),
					toggleableDiv = $('h2', '.filter'),
					radios = $('input[type=radio]'),
					checkboxes = $('input[type=checkbox]'),
					sizing = $('#sizing'),
					sort = $('#sort'),
					sortActions = $('a', '#sort-actions'),
					ajaxOverlay = '<div id="ajax-overlay"></div>',
					resultNum = $('#result-num');

				if ( window.innerWidth > 500 ) {
					$('html').addClass('is-tablet');
					$('.department:first').hide();
					$('.department:last').show();
					sizing.show();
				}

				button.on('click', function() {

					if ( !filters.hasClass('show') ) {
						// $('html').css('height', filters.height());
						filters.addClass('show');
						enableStickyButton($('#apply'), filters, true);
					} else {
						filters.removeClass('show');
						enableStickyButton($('#apply'), filters, false);
					}

				});

				// $('button', '.inline').on('click', function() {
				// 	$(this).prop('disabled', true);
				// });

				$('input', '.inline').on('keyup', function() {
					if ( $(this).val() !== '' ) {
						$(this).parents('div').find('.hidden').show();
					} else {
						$(this).parents('div').find('.hidden').hide();
					}
				});

				sort.on('click', function() {
					$('#sort-actions').toggleClass('show');
				});

				sortActions.on('click', function() {
					location.reload(true);
				});

				$('#close-sort').on('click', function() {
					$('#sort-actions').removeClass('show');
				});

				toggle.on('click', function() {
					var ctx = $(this).hasClass('active') ? 'All items' : 'Sale items only';

					ajaxUpdateFilters(ajaxOverlay);
					toggle.toggleClass('active');
					setDataAttr(toggle.prev('h2'), ctx);
				});

				tabs.on('click', function() {
					ajaxUpdateFilters(ajaxOverlay);
					tabs.removeClass('active');
					$(this).addClass('active');
				});

				radios.on('click', function() {
					ajaxUpdateFilters(ajaxOverlay);
					setDataAttr($(this).parents('[data-toggleable]').find('h2'), $(this));
				});

				checkboxes.on('click', function() {
					ajaxUpdateFilters(ajaxOverlay);
					setDataAttr($(this).parents('[data-toggleable]').find('h2'), $(this).parent().find('input:checked'));
				});

				toggleableDiv.on('click', function() {
					if ( $(this).parent().data('toggleable') !== undefined ) {
						$(this).toggleClass('open');
						$(this).next('div').toggle();
					}
				});

				apply.on('click', function() {
					fuaxSubmit($(this), filters, false);
				});

			});

			function ajaxUpdateFilters(content) {
				var num = parseInt($('#result-num').text(), 10),
					numMinus = [11121, 5257, 8753][Math.floor(Math.random() * 3)],
					newNum = num - numMinus;

				console.log(num, numMinus, newNum);

				setTimeout(function() {
					$('html').append(content);
				}, 251);
				setTimeout(function() {
					$('#ajax-overlay').remove();
					$('#result-num').text(newNum);
				}, 751);
			}

			function setDataAttr(el, selected) {
				var val = selected.val(),
					checkbox = selected.attr('type') === 'checkbox' ? true : false,
					size = selected.data('sizing') !== undefined ? true : false,
					selectdReturn = selected.data('return') !== undefined ? true : false;

				console.log(el, selected, val);

				setTimeout(function() {
					
					if ( checkbox ) {
						var multiSelected = selected.attr('name');

						if ( $('input[name=' + multiSelected + ']:checked').length > 1 ) {
							el.attr('data-selected', 'Multiple');
						} else if ( $('input[name=' + multiSelected + ']:checked').length < 1 ) {
							el.attr('data-selected', 'All');
						} else {
							el.attr('data-selected', val);
						}

					} else {
						el.attr('data-selected', val);
					}

					if ( selectdReturn ) {
						return;
					}
					if ( size ) {
						$('#sizing').show();
					} else {
						$('#sizing').hide();
					}
				}, 751);
			}

			function fuaxSubmit(el, parEl, ctx) {
				el.find('button').text('').prop('disabled', true);
				setTimeout(function() {
					location.reload(true);
				}, 750);
			}

			function enableStickyButton(el, parEl, ctx) {
				var css = ctx ? 'fixed' : 'absolute',
					parCss = ctx ? 'absolute' : 'fixed';

				if ( !ctx ) {
					parEl.css('position', parCss);
					el.css('position', css).find('button').text('Apply Filters').prop('disabled', false);
					$('#content').show();
					return;
				}

				setTimeout(function() {
					parEl.css('position', parCss);
					el.css('position', css);
					$('#content').hide();
				}, 251);

			}

		</script>
		
	</body>
</html>