<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
	    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" />
	    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Tradesy.com Filters</title>
		<link rel="stylesheet" href="css/app.css" />
		<script>document.addEventListener("touchstart", function() {},false);</script>
	</head>
	<body>

		<header></header>

		<div id="content">
			<div id="filter-sort" class="cf">
				<button type="button" class="toggle-filters">
					<img src="img/filter.png" />
					Filter
				</button>
				<button type="button" id="sort">
					<img src="img/sort.png" />
					Sort
				</button>
				<!-- <h3>Applied Filters</h3>
				<div id="applied-filters">
					<div>
						<button type="button" data-filter="size">
							Size 7
						</button>
						<button type="button" data-filter="department">
							Shoes
						</button>
						<button type="button" data-filter="sale">
							On Sale
						</button>
						<button type="button" data-filter="designer">
							Louis Vuitton
						</button>
						<button type="button" data-filter="color">
							Red
						</button>
						<button type="button" data-filter="color-2">
							Multi
						</button>
					</div>
				</div> -->
			</div>
			<small>
				Viewing 1-24 of 59,291 items<!--  in <strong>Shoes</strong> -->
				<button type="button"><!-- Share -->&nbsp;</button>
			</small>
			<div class="cf">
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
				<div class="item"></div>
			</div>
		</div>
		<div id="sort-actions">
			<div class="intro">
				Sort items by:
				<button type="button" id="close-sort"></button>
			</div>
			<a class="active">Relevance</a>
			<a>New Arrivals</a>
			<a>Most Loved</a>
			<a>Lowest $ to Highest $$$</a>
			<a>Highest $$$ to Lowest $</a>
		</div>
		<div id="filters">
			<div class="intro">
				Filters
				<button type="button" class="toggle-filters"></button>
			</div>
			
			<div id="filter-wrapper">

				
				<div class="filter" data-slideable>
					<h2>
						<span>
							Size
							<em>5, 5.5 and 6</em>
						</span>
					</h2>
				</div>

				<div class="filter-open">
					<h2>
						<span>
							Department
						</span>
					</h2>

					<div class="radios-as-checks">
						<label>
							<input type="checkbox" name="department" value="Clothing" data-sizing />
							<span>
								Clothing
							</span>
						</label>
						<label>
							<input type="checkbox" name="department" value="Bags" data-sizing />
							<span>
								Bags
							</span>
						</label>
						<label>
							<input type="checkbox" name="department" value="Shoes" data-sizing />
							<span>
								Shoes
							</span>
						</label>
						<label>
							<input type="checkbox" name="department" value="Accessories" data-sizing />
							<span>
								Accessories
							</span>
						</label>
						<label>
							<input type="checkbox" name="department" value="Wedding" data-sizing />
							<span>
								Weddings
							</span>
						</label>
					</div>

				</div>

				<div class="filter" data-toggleable>
					<h2>
						<span>
							Color
						</span>
					</h2>
				</div>

				<div class="filter" data-slideable>
					<h2>
						<span>
							Designer
						</span>
					</h2>
				</div>

				<div class="filter" data-slideable>
					<h2>
						<span>
							Collection
							<em>Shoesday: Under $100</em>
						</span>
					</h2>
				</div>
				

				<div id="apply">
					<button data-submit>Apply Filters</button>
				</div>

			</div>
		</div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script>

			$(function() {
				var button = $('.toggle-filters'),
					filters = $('#filters'),
					tabs = $('span', '.tab'),
					toggle = $('#toggle'),
					apply = $('#apply'),
					toggleableDiv = $('h2', '.filter'),
					radios = $('input[type=radio]'),
					checkboxes = $('input[type=checkbox]'),
					sizing = $('#sizing'),
					sort = $('#sort'),
					sortActions = $('a', '#sort-actions'),
					ajaxOverlay = '<div id="ajax-overlay"></div>',
					resultNum = $('#result-num');

				if ( window.innerWidth > 500 ) {
					$('html').addClass('is-tablet');
					$('.department:first').hide();
					$('.department:last').show();
					sizing.show();
				}

				if ( window.location.hash ) {
					$('#department').text('Department');
					$('label.shoes', '#images').remove();
					$('label.dept', '#images').removeClass('hidden');

					if (window.location.hash.indexOf('removed') > -1) {
						// window.location.reload(true);
						var filterRemoved = window.location.hash.replace('#removed=', '');
						$('[data-filter=' + filterRemoved + ']').remove();
					}
				}

				button.on('click', function() {

					if ( !filters.hasClass('show') ) {
						// $('html').css('height', filters.height());
						filters.addClass('show');
						enableStickyButton($('#apply'), filters, true);
					} else {
						filters.removeClass('show');
						enableStickyButton($('#apply'), filters, false);
					}

				});

				// $('button', '.inline').on('click', function() {
				// 	$(this).prop('disabled', true);
				// });

				$('input', '.inline').on('keyup', function() {
					if ( $(this).val() !== '' ) {
						$(this).parent().parent().parent().find('.hidden').show();
						$(this).parent().parent().parent().find('.vis').hide();
					} else {
						$(this).parent().parent().parent().find('.hidden').hide();
						$(this).parent().parent().parent().find('.vis').show();
					}
				});

				$('#load-collections').on('click', function() {
					var nextFour = $(this).parents('.collections').find('.hidden'),
						i = 0,
						last = false;

					if ( nextFour.length <= 4 ) {
						last = true;
					}

					$(this).prop('disabled', true);

					$('html, body').animate({
						scrollTop : $(this).offset().top
					}, 500);

					enableButton($(this));

					nextFour.each(function(i) {

						if ( i > 3 ) {
							return;
						}

						if ( last ) {
							$('#load-collections').remove();
						}

						$(this).removeClass('hidden');
						i++;
					});
				});

				sort.on('click', function() {
					$('#sort-actions').toggleClass('show');
				});

				sortActions.on('click', function() {
					location.reload(true);
				});

				$('#close-sort').on('click', function() {
					$('#sort-actions').removeClass('show');
				});

				toggle.on('click', function() {
					var ctx = $(this).hasClass('active') ? 'All items' : 'Sale items only';

					ajaxUpdateFilters(ajaxOverlay);
					toggle.toggleClass('active');
					setDataAttrNonVal(toggle.prev('h2'), ctx);
				});

				tabs.on('click', function() {

					var thisTabs = $(this).siblings('span');

					if ( $(this).hasClass('disabled') ) {
						return;
					}

					// ajaxUpdateFilters(ajaxOverlay);
					thisTabs.removeClass('active');
					$(this).addClass('active');
				});

				radios.on('click', function() {
					var checked = $(this).prop('checked') === true ? true : false;

					// console.log(checked);

					ajaxUpdateFilters(ajaxOverlay);
					setDataAttr($(this).parents('[data-toggleable]').find('h2'), $(this), checked);
				});

				checkboxes.on('click', function() {
					var checked = $(this).prop('checked') === true ? true : false;

					// console.log(checked);

					ajaxUpdateFilters(ajaxOverlay);
					setDataAttr($(this).parents('[data-toggleable]').find('h2'), $(this).parent().find('input'), checked);
				});

				toggleableDiv.on('click', function() {
					if ( $(this).parent().data('toggleable') !== undefined ) {

						if ($(this).parent().data('not') !== undefined) {
							return;
						}

						if ( !$(this).hasClass('open') ) {
							$('html, body').animate({
								scrollTop : $(this).offset().top
							}, 500);
						}

						$(this).toggleClass('open');
						$(this).next('div').toggle();
					}
				});

				$('input', '.radios-as-checks').on('click', function() {
					var relatedInputs = $(this).parents('.radios-as-checks').find('input'),
						thisInputChecked = $(this).prop('checked') ? true : false;

					relatedInputs.prop('checked', false);
					$(this).prop('checked', thisInputChecked);
				});

				$('input', '.color').on('click', function() {
					$(this).parents('label').toggleClass('checked');
				});

				$('input', '.images').on('click', function() {
					var radio = $(this).attr('type') === 'radio' ? true : false;

					if ( radio ) {
						$(this).parents('.images').find('label').removeClass('checked');
					}

					$(this).parents('label').toggleClass('checked');
				});

				// $('input', '.collections').on('click', function() {
				// 	$(this).parents('div').find('label').removeClass('checked');
				// 	$(this).parents('label').addClass('checked');
				// });

				$('input', '.size').on('click', function() {
					var radio = $(this).attr('type') === 'radio' ? true : false;

					if ( radio ) {
						$(this).parents('.size').find('label').removeClass('checked');
					}

					$(this).parents('label').toggleClass('checked');
				});

				apply.on('click', function(e) {

					if ( $(e.target).data('submit') === undefined ) {
						reset($(e.target));
						return;
					}

					fuaxSubmit($(this), filters, false);
				});

				$('button', '#applied-filters').on('click', function() {
					var filter = $(this).data('filter');
					window.location.href = window.location.pathname + '#removed=' + filter;
				});

				$('#size-card').on('click', function() {
					$('html, body').animate({
						scrollTop : $('html, body').offset().top
					}, 125);
					setTimeout(function() {
						$('#size-wrapper').addClass('left');
						$('#non-size-filters').addClass('transitioning opaque');
						$('.intro:first', '#filters').addClass('left');
					}, 126);
					setTimeout(function() {
						$('#size-wrapper').css('position', 'absolute');
						$('#non-size-filters').hide();
					}, 376);
				});

				$('#size-out').on('click', function() {
					$('html, body').animate({
						scrollTop : $('html, body').offset().top
					}, 125);

					setTimeout(function() {
						var sizes = $('[name=size]:checked'),
							sizePref = '';

						if (sizes.length > 1) {
							var vals = '',
								valsCount = 0;

							sizes.each(function() {
								if ( valsCount > 1 ) {
									if (valsCount > 2 ) {
										vals = vals.slice(0, -8);
									}
									vals += ' + ' + (valsCount - 1) + ' more';
								} else {
									vals += (valsCount === 0) ? $(this).val() : ' + ' + $(this).val();
								}
								valsCount++;
							});

							sizePref = vals;
						} else {
							sizePref = sizes.val();
						}

						$('#non-size-filters').show();
						$('h2', '#size-card').attr('data-selected', sizePref);
						$('#size-wrapper').removeClass('left').css('position', 'fixed');
					}, 126);
					setTimeout(function() {
						$('#non-size-filters').removeClass('transitioning');
						$('.intro:first', '#filters').removeClass('left');
					}, 201);
					setTimeout(function() {
						$('#non-size-filters').removeClass('opaque');
					}, 376);
				});

				$('input:disabled').parents('label').addClass('disabled');

			});

			function enableButton(el) {
				setTimeout(function() {
					el.prop('disabled', false);
				}, 500);
			}

			function reset(el) {
				el.prop('disabled', true);
				setTimeout(function() {
					el.prop('disabled', false);
				}, 750);
			}

			function ajaxUpdateFilters(content) {
				var num = parseInt($('#result-num').text(), 10),
					numMinus = [11121, 5257, 8753][Math.floor(Math.random() * 3)],
					newNum = num - numMinus;

				// console.log(num, numMinus, newNum);

				setTimeout(function() {
					$('html').append(content);
				}, 125);
				setTimeout(function() {
					$('#ajax-overlay').remove();
					// $('#result-num').text(newNum);
				}, 701);
			}

			function setDataAttr(el, selected, addDisabled) {
				var val = selected.val(),
					checkbox = selected.attr('type') === 'checkbox' ? true : false,
					size = selected.data('sizing') !== undefined ? true : false,
					selectdReturn = selected.data('return') !== undefined ? true : false,
					disablable = $('#filters').find('input[data-disablable]');

				if (selected.data('dont') !== undefined) {
					return;
				}

				setTimeout(function() {

					// if (window.location.hash) {
						if (el.next('div').attr('id') === 'images') {
							if (addDisabled) {
								disablable.prop('disabled', true);
							} else {
								disablable.prop('disabled', false);
							}
						}
					// }
					
					if ( checkbox ) {
						var multiSelected = selected.attr('name');

						// console.log(selected.length, $('input[name=' + multiSelected + ']:checked').length);

						if ( $('input[name=' + multiSelected + ']:checked').length > 1 ) {
							var vals = '',
								valsCount = 0;

							$('input[name=' + multiSelected + ']:checked').each(function() {
								if ( valsCount > 1 ) {
									if (valsCount > 2 ) {
										vals = vals.slice(0, -8);
									}
									vals += ' + ' + (valsCount - 1) + ' more';
								} else {
									vals += (valsCount === 0) ? $(this).val() : ' + ' + $(this).val();
								}
								valsCount++;
							});

							el.attr('data-selected', vals);
						} else if ( $('input[name=' + multiSelected + ']:checked').length < 1 ) {
							el.attr('data-selected', 'All');
						} else {
							el.attr('data-selected', $('input[name=' + multiSelected + ']:checked').val());
						}

					} else {

						if (selected.length < 1) {
							el.attr('data-selected', 'All');
							return;
						}

						el.attr('data-selected', val);
					}

					if ( selectdReturn ) {
						return;
					}
				}, 751);
			}

			function setDataAttrNonVal(el, text) {
				var selectdReturn = el.data('return') !== undefined ? true : false;

				setTimeout(function() {
					
					el.attr('data-selected', text);

				}, 751);
			}

			function fuaxSubmit(el, parEl, ctx) {
				el.find('button:first').prop('disabled', true);
				setTimeout(function() {
					location.reload(true);
				}, 750);
			}

			function enableStickyButton(el, parEl, ctx) {
				var css = ctx ? 'fixed' : 'absolute',
					parCss = ctx ? 'absolute' : 'fixed';

				if ( !ctx ) {
					parEl.css('position', parCss);
					el.css('position', css).find('button').text('Apply Filters').prop('disabled', false);
					$('#content').show();
					return;
				}

				setTimeout(function() {
					parEl.css('position', parCss);
					el.css('position', css);
					$('#content').hide();
				}, 251);

			}

		</script>
		
	</body>
</html>